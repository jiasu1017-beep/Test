# 小马办公 v0.0.2 发布文档

## 📋 基本信息

| 项目 | 详情 |
|------|------|
| **版本号** | v0.0.2 |
| **发布日期** | 2026年02月11日 |
| **开发者** | 小马办公团队 |
| **适用系统** | Windows 7 及以上 (64位) |
| **Git 标签** | v0.0.2 |

---

## 🎉 版本亮点

本版本主要聚焦于**修复自动更新功能的关键问题**，优化用户体验：

1. ✅ **修复了两个重复【发现新版本】对话框的问题**
2. ✅ 完善了更新流程和用户交互
3. ✅ 优化了更新内容展示界面

---

## 📝 详细更新内容

### 🔧 问题修复

#### 1. 修复重复的【发现新版本】对话框
- **问题**：更新检查时会同时显示两个完全相同的更新对话框
- **原因**：MainWindow 和 SettingsWidget 都连接了 updateAvailable 信号
- **修复**：移除了 SettingsWidget 中的重复信号连接，只保留 MainWindow 中的单一处理
- **影响文件**：`settingswidget.cpp:26`

#### 2. HTTP 重定向问题修复
- **问题**：GitHub Release 下载时遇到 302 重定向会失败
- **修复**：为所有网络请求添加了重定向跟随功能
- **代码变更**：在 QNetworkRequest 中设置 `FollowRedirectsAttribute`

#### 3. 文件验证失败问题
- **问题**：下载的文件大小与预期不完全匹配时会失败
- **修复**：优化验证逻辑，仅在文件为 0 字节时失败，大小不匹配时记录警告但继续执行
- **文件**：`updatemanager.cpp`

#### 4. 文件替换失败问题
- **问题**：更新安装时因文件被占用导致无法替换
- **修复**：
  - 改进文件替换逻辑，跳过正在运行的可执行文件
  - 创建独立的更新助手程序 Updater.exe
  - 在主程序退出后完成文件替换
- **新增文件**：`Updater/` 项目

---

### 🎨 功能改进

#### 1. 下载前确认对话框
- 更新可用时，先显示确认对话框，用户确认后再开始下载
- 提供"立即更新"、"稍后提醒"、"跳过此版本"三个选项

#### 2. 详细更新进度显示
- 创建了新的更新进度对话框 `UpdateProgressDialog`
- 显示下载进度、解压进度、安装进度
- 实时更新状态信息

#### 3. 更新完成后自动重启
- 更新安装成功后，自动重启主程序
- 用户无需手动重新打开软件

#### 4. 优化的更新内容展示界面
- **结构化展示**：包含版本号、发布日期等基本信息
- **分类显示**：
  - ✨ 新增功能
  - 🔧 功能改进
  - 🐛 问题修复
  - ⚡ 性能优化
- **滚动查看**：支持长更新列表的滚动浏览
- **美观 UI**：与软件整体风格保持一致的视觉设计

---

### 🔬 技术优化

1. **完善的日志系统**
   - 添加了详细的日志记录
   - 便于问题诊断和调试

2. **独立更新助手**
   - 新建 Updater 独立项目
   - 负责在主程序退出后完成文件替换
   - 避免文件被占用问题

3. **文件替换优化**
   - 支持文件过滤
   - 单个文件失败不影响整体更新
   - 更好的错误处理

---

## 📦 安装说明

### 方式一：全新安装

1. 下载 `release-v0.0.2.zip`（或对应的发布包）
2. 解压到任意目录（例如：`C:\Program Files\PonyWork`）
3. 运行 `PonyWork.exe`
4. 首次运行会自动创建数据目录

### 方式二：从 v0.0.1 升级

1. 软件启动时会自动检查更新
2. 或在"设置"界面点击"检查更新"
3. 按照提示完成更新即可

---

## 🖥️ 系统要求

| 项目 | 要求 |
|------|------|
| 操作系统 | Windows 7 及以上 |
| 系统架构 | 64位 (x64) |
| 内存 | 512 MB 可用内存 |
| 硬盘空间 | 100 MB 可用空间 |
| 网络 | 需要网络连接以使用自动更新功能 |

---

## 🔄 更新历史

### v0.0.2 (2026-02-11)
- 修复两个重复【发现新版本】对话框的问题
- 修复 HTTP 302 重定向问题
- 修复文件验证失败问题
- 修复文件替换失败问题
- 优化更新内容展示界面
- 完善更新流程

### v0.0.1 (2026-02-11)
- 初始版本发布
- 实现基本的自动更新功能

---

## 💡 已知问题与限制

1. **Windows 7 兼容性**：在某些 Windows 7 系统上可能需要手动安装 Visual C++ Redistributable
2. **网络要求**：自动更新需要能够访问 GitHub
3. **管理员权限**：安装到系统目录（如 Program Files）可能需要管理员权限

---

## 📞 反馈与支持

如在使用过程中遇到问题，欢迎通过以下方式反馈：

1. **提交 Issue**：在 GitHub 仓库提交 Issue
2. **功能建议**：欢迎提出新功能建议
3. **Pull Request**：欢迎贡献代码

---

## 📄 许可证

本项目采用 MIT 许可证。

---

## 🎊 致谢

感谢所有为小马办公项目做出贡献的开发者！

---

**最后更新**：2026年02月11日  
**文档版本**：1.0
